<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fetch with Credentials</title>
  <style>
pre{
  background: #333;
  overflow: auto;
  border-radius: 5px;
  padding: 10px 15px;
  color: white;
}
button{
  border: 1px solid lightgray;
  border-radius: 2px;
}
.btn-group{
  margin-bottom: 25px;
}
.btn-group .note{
  background-color: #e5ffe5;
  padding: 10px 15px;
  border-radius: 5px;
}
  </style>
</head>
<body>
  <h1>Fetch with Credentials</h1>

  <section>
    <p>Cookie: <span id="cookie">Reading...</span></p>
  </section>

  <section>
    <p>HTTP headers:</p>
    <pre><code id="headers">Click following buttons to fetch...</code></pre>

    <div class="btn-group">
      <button id="sw-fetch">Fetch in Service Worker</button>
      <p class="note"> Trigger <code>ServiceWorkerGlobalScope.fetch()</code> </p>
    </div>
    <div class="btn-group">
      <button id="win-fetch">Fetch in Window</button>
      <button id="win-fetch-with-credentials">Fetch with credentials</button>
      <p class="note"> Trigger <code>window.fetch()</code> </p>
    </div>
    <div class="btn-group">
      <button id="ajax-fetch">Ajax Fetch</button>
      <p class="note"> Trigger <code>XMLHttpRequest.send()</code> </p>
    </div>
  </section>

  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script>

(function(){
    if(location.port !== "8081") {
      var alert = $('<div>').css('background', 'red').css('color', 'white').css('padding', '15px 30px');
      $('<p>').text('Please run this demo in Node.js by node ./server.js').appendTo(alert);
      $('<p>').text('Source:').appendTo(alert);

      var url = 'https://github.com/service-worker/demos/tree/master/simple-fetch';
      var a = $('<a>').attr('href', url).text(url);

      $('<p>').append(a).appendTo(alert);
      $('body').prepend(alert)
      return
    }

    navigator.serviceWorker.register('./sw.js')
      .catch(function(e){
        alert('service worker register error')
        throw e
      })

    document.cookie = "author=harttle"
    $('#cookie').text(document.cookie)

    $('#sw-fetch').click(function(){
      $('#headers').text('sw.fetch() pending...')
      $.get('/sw-reflect')
        .done(x => $('#headers').text(x))
        .fail(x => $('#headers').text('fetch error'))
    })
    $('#win-fetch').click(function(){
      $('#headers').text('window.fetch() pending...')
      fetch('/reflect')
        .then(res => res.text())
        .then(text => $('#headers').text(text))
        .catch(x => $('#headers').text('fetch error'))
    })
    $('#win-fetch-with-credentials').click(function(){
      $('#headers').text('window.fetch() pending...')
      fetch('/reflect', {credentials: 'same-origin'})
        .then(res => res.text())
        .then(text => $('#headers').text(text))
        .catch(x => $('#headers').text('fetch error'))
    })
    $('#ajax-fetch').click(function(){
      $('#headers').text('ajax pending...')
      $.get('/reflect')
        .done(x => (window.x =x, $('#headers').text(x)))
        .fail(x => $('#headers').text('fetch error'))
    })

})()
  </script>

  <footer>Proudly hosted by <a href="/">Github</a>,
    view source <a href="https://github.com/service-worker/demos/tree/master/fetch-with-credentials">here</a>.</footer>
</body>
</html>
